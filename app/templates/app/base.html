{% load static %}
{% load i18n %}
{% load bootstrap5 %}

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>GradeSmart</title>
    <link href="{% static 'css/styles.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.css" rel="stylesheet">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <!-- Optional custom CSS -->
    <!-- <link rel="stylesheet" href="{% static 'css/styles.css' %}"> -->

    <link rel="icon" href="{% static 'images/favicon.ico' %}">
  </head>

  <body>
    <!-- Navbar -->
    <!-- Navbar -->
     {% if user.is_authenticated %}
<nav class="navbar navbar-expand-sm navbar-dark bg-dark shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold" href="{% url 'homepage' %}">{% trans "GradeSmart" %}</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav me-3">
        <li class="nav-item">
          <a id="read-page" class="nav-link" href="javascript:void(0)" onclick="readPage()">{% trans "Read Page" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'homepage' %}">{% trans "Home" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'dashboard' %}">{% trans "Dashboard" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'progress' %}">{% trans "Student Progress" %}</a>
        </li>
      </ul>
      <a href="{% url 'account_logout' %}" class="btn btn-primary">{% trans "Logout" %}</a>
    </div>
  </div>
</nav>
    {% else %}
<nav class="navbar navbar-expand-sm navbar-dark bg-dark shadow-sm">
  <div class="container">   
    <a class="navbar-brand fw-bold" href="{% url 'homepage' %}">{% trans "GradeSmart" %}</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav me-3">
        <li class="nav-item">
          <a id="read-page" class="nav-link" href="javascript:void(0)" onclick="readPage()">{% trans "Read Page" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'homepage' %}">{% trans "Home" %}</a>
        </li>
      </ul>
      <a href="{% url 'account_signup' %}" class="btn btn-primary">{% trans "Get Started" %}</a>
    </div>
  </div>
</nav>
    {% endif %}
{% block content %}
{% endblock %}

    <!-- Footer -->
<footer class="footer bg-dark text-white pt-5 mt-5 mt-auto">
      <div class = "height-25">
      <div class="footerContent container">
        <div class="row">
          <!-- About Us -->
          <div class="col-md-4 mb-0">
            <h5 class = "fs-6">{% trans "About Us" %}</h5>
            <ul class="list-unstyled">
              <li><a class="text-white text-decoration-none" href="#">{% trans "Mission" %}</a></li>
              <li><a class="text-white text-decoration-none" href="#">{% trans "FAQs" %}</a></li>
              <li><a class="text-white text-decoration-none" href="#">{% trans "Terms of Service" %}</a></li>
              <li><a class="text-white text-decoration-none" href="#">{% trans "Sources" %}</a></li>
              <li><a class="text-white text-decoration-none" href="#">{% trans "Privacy Policy" %}</a></li>
            </ul>
          </div>

          <!-- Contact -->
          <div class="col-md-4 mb-0">
            <h5 class = "fs-6">{% trans "Contact Us" %}</h5>
            <p>{% trans "Phone:" %} (123) 456-7890</p>
            <a class="btn btn-outline-light btn-sm" target="_blank" href="https://docs.google.com/forms/d/e/1FAIpQLSeJ6hK63lKGIovrIFJzEEcAM0_yhsLDKZgWhwxQtK1Tq_Y9Lg/viewform?usp=header">{% trans "Support Form" %}</a>
          </div>

          <!-- Social & Language -->
          <div class="col-md-4 mb-0">
            <h5 class = "fs-6">{% trans "Social Media" %}</h5>
            <ul class="list-unstyled">
              <li><a class="text-white text-decoration-none" href="https://x.com/?mx=2">X</a></li>
              <li><a class="text-white text-decoration-none" href="https://instagram.com">Instagram</a></li>
              <li><a class="text-white text-decoration-none" href="https://linkedin.com">LinkedIn</a></li>
            </ul>

            <!-- Language Selector -->
            <!-- Language Selector -->
            <form id="language-form" method="post" action="{% url 'set_language' %}">
                {% csrf_token %}
                <select name="language" class="form-select form-select-sm mt-2" id="language-select">
                    {% get_current_language as LANGUAGE_CODE %}
                    {% get_available_languages as LANGUAGES %}
                    {% for lang in LANGUAGES %}
                        <option value="{{ lang.0 }}" {% if lang.0 == LANGUAGE_CODE %}selected{% endif %}>{{ lang.1 }}</option>
                    {% endfor %}
                </select>
                <input type="hidden" name="next" id="next-input" value="{{ request.path }}">
            </form>

            <script>
                const select = document.getElementById('language-select');
                const form = document.getElementById('language-form');
                const nextInput = document.getElementById('next-input');

                select.addEventListener('change', () => {
                    // Update "next" so switching to default language removes /es/ prefix
                    let path = window.location.pathname;

                    // If switching to English (default) and path starts with /es/, remove it
                    if (select.value === 'en' && path.startsWith('/es/')) {
                        path = path.replace('/es', '');
                    }

                    // If switching to Spanish and path doesn't start with /es/, add it
                    if (select.value === 'es' && !path.startsWith('/es/')) {
                        path = '/es' + path;
                    }

                    nextInput.value = path;
                    form.submit();
                });
            </script>

          </div>
        </div>
      </div>
      </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      function readPage() {
        const btn = document.getElementById("read-page");
        if (btn.innerText === "Read Page") {
          let text = document.body.innerText;
          let speech = new SpeechSynthesisUtterance(text);
          speech.lang = "en-US";
          speech.rate = 1.0;
          speech.volume = 1.0;
          window.speechSynthesis.speak(speech);
          btn.innerText = "Stop Reading";
        } else {
          window.speechSynthesis.cancel();
          btn.innerText = "Read Page";
        }
      }
    </script>
  </body>
</html>
